<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="exhibitionns">
	<resultMap type="exhibition" id="exhibitionResult">
		<result property="exhibition_no" column="exhibition_no" />
		<result property="b_id" column="b_id" />
		<result property="title" column="title" />
		<result property="artist" column="artist" />
		<result property="gallery" column="gallery" />
		<result property="gallery_site" column="gallery_site" />
		<result property="local_no" column="local_no" />
		<result property="address" column="address" />
		<result property="ticket_link1" column="ticket_link1" />
		<result property="ticket_link2" column="ticket_link2" />
		<result property="ticket_link3" column="ticket_link3" />
		<result property="price" column="price" />
		<result property="start_date" column="start_date" />
		<result property="end_date" column="end_date" />
		<result property="hashtags" column="hashtags" />
		<result property="content" column="content" />
		<result property="like_cnt" column="like_cnt" />
		<result property="reg_date" column="reg_date" />
		<result property="del" column="del" />
		<result property="filename" column="filename" />
	</resultMap>
		
		<select id="getTotal" resultType="integer">
			select count(*) from exhibition
			<include refid="search"></include>
		</select>
		<select id="list" parameterType="hashmap" resultMap="exhibitionResult">
			select * from exhibition
			<include refid="search"></include>
			order by exhibition_no limit ${startRow}, ${endRow}
		</select>
		<sql id="search">
			<if test="keyword != null">
				where hashtags like concat('%',#{keyword},'%')
			</if>
		</sql>
		<insert id="insert" parameterType="exhibition">
			insert into exhibition values (
				exhibition_no,#{b_id},#{title},#{artist},#{gallery},#{gallery_site},
				#{address},#{ticket_link1},#{ticket_link2},#{ticket_link3},
				#{price},#{start_date},#{end_date},#{hashtags},#{content},0,now(),'n',#{filename}
			)
		</insert>
		<select id="view" parameterType="integer" resultType="exhibition">
			select * from exhibition where exhibition_no=#{exhibition_no}
		</select>
		<select id="select" parameterType="integer" resultType="exhibition">
			select * from exhibition where exhibition_no=#{exhibition_no}  
		</select>
		<update id="update" parameterType="exhibition">
			update exhibition set 
			title=#{title}, gallery=#{gallery}, address=#{address}, price=#{price},
			start_date=#{start_date}, end_date=#{end_date}, hashtags=#{hashtags}, content=#{content}, filename=#{filename}
			where exhibition_no=#{exhibition_no}
		</update>
		<update id="delete" parameterType="integer">
			update exhibition set del='y' where exhibition_no=#{exhibition_no}
		</update>
		<update id="likeCntUp" parameterType="integer">
			update exhibition set like_cnt = like_cnt + 1
			where exhibition_no=#{exhibition_no}
		</update>
		<update id="likeCntDown" parameterType="integer">
			update exhibition set like_cnt = like_cnt - 1
			where exhibition_no=#{exhibition_no}
		</update>
</mapper>